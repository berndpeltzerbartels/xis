var categories = [
    {
        title: 'Küche', products: [
            { title: 'Kochtopf', price: 12.5 },
            { title: 'Braftpfanne', price: 12.5 },
            { title: 'Topflappen', price: 12.5 },
            { title: 'Espressokocher', price: 12.5 }
        ]
    },
    {
        title: 'Bad', products: [
            { title: 'Vorleger', price: 12.5 },
            { title: 'Klobürste', price: 12.5 }
        ]
    },
    {
        title: 'Küche', products: [
            { title: 'Kochtopf', price: 12.5 },
            { title: 'Braftpfanne', price: 12.5 },
            { title: 'Topflappen', price: 12.5 },
            { title: 'Espressokocher', price: 12.5 }
        ]
    },
    {
        title: 'Bad', products: [
            { title: 'Vorleger', price: 12.5 },
            { title: 'Klobürste', price: 12.5 }
        ]
    },
    {
        title: 'Küche', products: [
            { title: 'Kochtopf', price: 12.5 },
            { title: 'Braftpfanne', price: 12.5 },
            { title: 'Topflappen', price: 12.5 },
            { title: 'Espressokocher', price: 12.5 }
        ]
    },
    {
        title: 'Bad', products: [
            { title: 'Vorleger', price: 12.5 },
            { title: 'Klobürste', price: 12.5 }
        ]
    },
    {
        title: 'Küche', products: [
            { title: 'Kochtopf', price: 12.5 },
            { title: 'Braftpfanne', price: 12.5 },
            { title: 'Topflappen', price: 12.5 },
            { title: 'Espressokocher', price: 12.5 }
        ]
    },
    {
        title: 'Bad', products: [
            { title: 'Vorleger', price: 12.5 },
            { title: 'Klobürste', price: 12.5 }
        ]
    },
    {
        title: 'Küche', products: [
            { title: 'Kochtopf', price: 12.5 },
            { title: 'Braftpfanne', price: 12.5 },
            { title: 'Topflappen', price: 12.5 },
            { title: 'Espressokocher', price: 12.5 }
        ]
    },
    {
        title: 'Bad', products: [
            { title: 'Vorleger', price: 12.5 },
            { title: 'Klobürste', price: 12.5 }
        ]
    },
    {
        title: 'Küche', products: [
            { title: 'Kochtopf', price: 12.5 },
            { title: 'Braftpfanne', price: 12.5 },
            { title: 'Topflappen', price: 12.5 },
            { title: 'Espressokocher', price: 12.5 }
        ]
    },
    {
        title: 'Bad', products: [
            { title: 'Vorleger', price: 12.5 },
            { title: 'Klobürste', price: 12.5 }
        ]
    },
    {
        title: 'Küche', products: [
            { title: 'Kochtopf', price: 12.5 },
            { title: 'Braftpfanne', price: 12.5 },
            { title: 'Topflappen', price: 12.5 },
            { title: 'Espressokocher', price: 12.5 }
        ]
    },
    {
        title: 'Bad', products: [
            { title: 'Vorleger', price: 12.5 },
            { title: 'Klobürste', price: 12.5 }
        ]
    },
    {
        title: 'Küche', products: [
            { title: 'Kochtopf', price: 12.5 },
            { title: 'Braftpfanne', price: 12.5 },
            { title: 'Topflappen', price: 12.5 },
            { title: 'Espressokocher', price: 12.5 }
        ]
    },
    {
        title: 'Bad', products: [
            { title: 'Vorleger', price: 12.5 },
            { title: 'Klobürste', price: 12.5 }
        ]
    },
    {
        title: 'Küche', products: [
            { title: 'Kochtopf', price: 12.5 },
            { title: 'Braftpfanne', price: 12.5 },
            { title: 'Topflappen', price: 12.5 },
            { title: 'Espressokocher', price: 12.5 }
        ]
    },
    {
        title: 'Bad', products: [
            { title: 'Vorleger', price: 12.5 },
            { title: 'Klobürste', price: 12.5 }
        ]
    },
    {
        title: 'Küche', products: [
            { title: 'Kochtopf', price: 12.5 },
            { title: 'Braftpfanne', price: 12.5 },
            { title: 'Topflappen', price: 12.5 },
            { title: 'Espressokocher', price: 12.5 }
        ]
    },
    {
        title: 'Bad', products: [
            { title: 'Vorleger', price: 12.5 },
            { title: 'Klobürste', price: 12.5 }
        ]
    },
    {
        title: 'Küche', products: [
            { title: 'Kochtopf', price: 12.5 },
            { title: 'Braftpfanne', price: 12.5 },
            { title: 'Topflappen', price: 12.5 },
            { title: 'Espressokocher', price: 12.5 }
        ]
    },
    {
        title: 'Bad', products: [
            { title: 'Vorleger', price: 12.5 },
            { title: 'Klobürste', price: 12.5 }
        ]
    },
    {
        title: 'Küche', products: [
            { title: 'Kochtopf', price: 12.5 },
            { title: 'Braftpfanne', price: 12.5 },
            { title: 'Topflappen', price: 12.5 },
            { title: 'Espressokocher', price: 12.5 }
        ]
    },
    {
        title: 'Bad', products: [
            { title: 'Vorleger', price: 12.5 },
            { title: 'Klobürste', price: 12.5 }
        ]
    },
    {
        title: 'Küche', products: [
            { title: 'Kochtopf', price: 12.5 },
            { title: 'Braftpfanne', price: 12.5 },
            { title: 'Topflappen', price: 12.5 },
            { title: 'Espressokocher', price: 12.5 }
        ]
    },
    {
        title: 'Bad', products: [
            { title: 'Vorleger', price: 12.5 },
            { title: 'Klobürste', price: 12.5 }
        ]
    },
    {
        title: 'Küche', products: [
            { title: 'Kochtopf', price: 12.5 },
            { title: 'Braftpfanne', price: 12.5 },
            { title: 'Topflappen', price: 12.5 },
            { title: 'Espressokocher', price: 12.5 }
        ]
    },
    {
        title: 'Bad', products: [
            { title: 'Vorleger', price: 12.5 },
            { title: 'Klobürste', price: 12.5 }
        ]
    },
    {
        title: 'Küche', products: [
            { title: 'Kochtopf', price: 12.5 },
            { title: 'Braftpfanne', price: 12.5 },
            { title: 'Topflappen', price: 12.5 },
            { title: 'Espressokocher', price: 12.5 }
        ]
    },
    {
        title: 'Bad', products: [
            { title: 'Vorleger', price: 12.5 },
            { title: 'Klobürste', price: 12.5 }
        ]
    },
    {
        title: 'Küche', products: [
            { title: 'Kochtopf', price: 12.5 },
            { title: 'Braftpfanne', price: 12.5 },
            { title: 'Topflappen', price: 12.5 },
            { title: 'Espressokocher', price: 12.5 }
        ]
    },
    {
        title: 'Bad', products: [
            { title: 'Vorleger', price: 12.5 },
            { title: 'Klobürste', price: 12.5 }
        ]
    },
    {
        title: 'Küche', products: [
            { title: 'Kochtopf', price: 12.5 },
            { title: 'Braftpfanne', price: 12.5 },
            { title: 'Topflappen', price: 12.5 },
            { title: 'Espressokocher', price: 12.5 }
        ]
    },
    {
        title: 'Bad', products: [
            { title: 'Vorleger', price: 12.5 },
            { title: 'Klobürste', price: 12.5 }
        ]
    },
    {
        title: 'Küche', products: [
            { title: 'Kochtopf', price: 12.5 },
            { title: 'Braftpfanne', price: 12.5 },
            { title: 'Topflappen', price: 12.5 },
            { title: 'Espressokocher', price: 12.5 }
        ]
    },
    {
        title: 'Bad', products: [
            { title: 'Vorleger', price: 12.5 },
            { title: 'Klobürste', price: 12.5 }
        ]
    },
    {
        title: 'Küche', products: [
            { title: 'Kochtopf', price: 12.5 },
            { title: 'Braftpfanne', price: 12.5 },
            { title: 'Topflappen', price: 12.5 },
            { title: 'Espressokocher', price: 12.5 }
        ]
    },
    {
        title: 'Bad', products: [
            { title: 'Vorleger', price: 12.5 },
            { title: 'Klobürste', price: 12.5 }
        ]
    },
    {
        title: 'Küche', products: [
            { title: 'Kochtopf', price: 12.5 },
            { title: 'Braftpfanne', price: 12.5 },
            { title: 'Topflappen', price: 12.5 },
            { title: 'Espressokocher', price: 12.5 }
        ]
    },
    {
        title: 'Bad', products: [
            { title: 'Vorleger', price: 12.5 },
            { title: 'Klobürste', price: 12.5 }
        ]
    }

];


class Loop {
    constructor(parentProvider, element, arrayPath, itemVarName, indexVarName, numberVarname) {
        this.parentProvider = parentProvider;
        this.element = element;
        this.arrayPath = arrayPath;
        this.itemVarName = itemVarName;
        this.indexVarname = indexVarName;
        this.numberVarname = numberVarname;
        this.rows = [];
        
    }

    getValue(name) {
        if (name == this.arrayVarName) {
            return this.data;
        }
        if (name == this.itemVarName) {
            return this.item;
        }
        if (name == this.indexVarname) {
            return this.itemIndex;
        }
        if (name == this.numberVarname) {
            return this.itemIndex + 1;
        }
        return this.parentProvider.getValue(name);
    }

    getArray() {
        var rv = this.parentProvider.getValue(this.arrayPath[0]);
        for (var i = 1; i < this.arrayPath.length; i++) {
            rv = rv[this.arrayPath[i]];
        }
        return rv;
    }

    update() {
        this.data = this.getArray();
        this.resize(this.data.length);
        for (var i = 0; i < this.data.length; i++) {
            this.itemIndex = i;
            this.item = this.data[i];
            var children = this.rows[i];
            for (var j = 0; j < children.length; j++) {
                children[j].update();
            }
        }
    }

    resize(size) {
        while (this.rowCount() < size) {
            this.appendRow();
        }
        while (this.rowCount() > size) {
            this.removeRow();
        }
    }

    rowCount() {
        return this.rows.length;
    }


    appendRow() {
        var children = this.createChildren();
        for (var i = 0; i < children.length; i++) {
            this.element.appendChild(children[i].element);
        }
        this.rows.push(children);
    }

    removeRow() {
        if (this.rows.length > 0) {
            var children = this.rows.pop();
            for (var i = 0; i < children.length; i++) {
                this.element.removeChild(children[i].element);
            }
        }
    }

}


class CatWidget {

    constructor(element) {
        this.element = element;
        this.children = appendChildren(this, [new CatH3(this), new CatForDiv(this)]);
    }

    getValue(name) {
        return this.state[name];
    }

    update(state) {
        debugger;
        this.state = state;
        this.children.forEach(child => child.update());
    }

}


class CatH3 {
    constructor(parentProvider) {
        this.parentProvider = parentProvider;
        this.element = createElement('h3');
        this.children = [];
        // static content:
        this.element.innerText = 'Kategorien';
    }

    update() {
        // static content
    }

}

class CatForDiv extends Loop {

    constructor(parentProvider) {
        super(parentProvider,
            createElement('div'),
            ['categories'],
            'category',
            'categoryIndex',
            'categoryNumber');
    }

    createChildren() {
        return [new CatDiv(this)];
    }

}

class CatDiv {
    constructor(parentProvider) {
        this.parentProvider = parentProvider;
        this.element = createElement('div');
        this.children = appendChildren(this, [new CatH4(parentProvider), new ProdForUl(parentProvider)]);
    }

    update() {
        this.children.forEach(child => child.update());
    }

}


class CatH4 {
    constructor(parentProvider) {
        this.parentProvider = parentProvider;
        this.element = createElement('div');
        this.children = [];
    }

    update() {
        var text = '';
        text += this.parentProvider.getValue('categoryNumber');
        text += '. ';
        text += getValue(this.parentProvider, ['category', 'title']);
        if (this.element.innerText != text) {
            this.element.innerText = text;
        }
    }
}

class ProdForUl extends Loop {
    constructor(parentProvider) {
        super(parentProvider,
            createElement('ul'),
            ['category','products'],
            'product',
            'productIndex',
            'productNumber');
    }

    createChildren() {
        return [new ProdLi(this)];
    }
}


class ProdLi {
    constructor(parentProvider) {
        this.parentProvider = parentProvider;
        this.element = createElement('li');
        this.children = [];
    }

    update() {
        var text = '';
        text += getValue(this.parentProvider, ['product', 'title']);
        text += ' ';
        text += getValue(this.parentProvider, ['product', 'price']);
        text += ' EUR';
        if (this.element.innerText != text) {
            this.element.innerText = text;
        }
    }
}

/////////////////////////////////////////////////////////////////// Util Functions /////////////////////////////////////////////

function getValue(provider, path) {
    var rv = provider.getValue(path[0]);
    for (var i = 1; i < path.length; i++) {
        rv = rv[path[i]];
    }
    return rv;
}

function byId(id) {
    return document.getElementById(id);
}


function appendChildren(obj, childObjects) {
    for (var i = 0; i < childObjects.length; i++) {
        obj.element.appendChild(childObjects[i].element);
    }
    return childObjects;
}

function createElement(tagName, attributes = []) {
    var e = document.createElement(tagName);
    for (var name in attributes) {
        e.setAttribute(name, attributes[name]);
    }
    return e;
}

function nodeListToArray(nodeList) {
    var rv = [];
    for (var i = 0; i < nodeList.length; i++) {
        rv.push(nodeList.item(i));
    }
    return rv;
}

function notEmpty(value) {
    return value && value.length > 0;
}


function isArray(o) {
    return o.constructor == Array;
}

function buttonClicked() {
    var widget = new CatWidget(byId('content'));
    widget.update({categories: categories});
    setTimeout(() => {


        categories = [
            {
                title: 'Küche', products: [
                    { title: 'Kochtopf', price: 8 },
                    { title: 'Braftpfanne', price: 8 },
                    { title: 'Topflappen', price: 8 },
                    { title: 'Espressokocher', price: 8 }
                ]
            },
            {
                title: 'Bad', products: [
                    { title: 'Vorleger', price: 8 },
                    { title: 'Klobürste', price: 8 }
                ]
            },
            

        ];
        widget.update({categories: categories});


    }, 1000);
}
